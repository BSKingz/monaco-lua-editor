<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherCore Monaco-Editor - Luau IDE</title>
    <style>
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
        }
        
        #editor { 
            width: 100%; 
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="editor"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs/loader.min.js"></script>
    <script src="./api-parser.js"></script>
    <script>
        let editor;
        let apiParser;

        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs' } });
        require(['vs/editor/editor.main'], async function () {
            
            apiParser = new APIDocumentationParser();
            const apiCompletions = await apiParser.loadAPIDocumentation();
            
            monaco.editor.defineTheme('aethercore-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '6A9955', fontStyle: 'italic' },
                    { token: 'keyword', foreground: '569CD6', fontStyle: 'bold' },
                    { token: 'string', foreground: 'CE9178' },
                    { token: 'number', foreground: 'B5CEA8' },
                    { token: 'regexp', foreground: 'D16969' },
                    { token: 'type', foreground: '4EC9B0' },
                    { token: 'class', foreground: '4EC9B0' },
                    { token: 'function', foreground: 'DCDCAA' },
                    { token: 'variable', foreground: '9CDCFE' },
                    { token: 'constant', foreground: '4FC1FF' },
                    { token: 'constant.other.color', foreground: 'FF6B6B' },
                    { token: 'support.function', foreground: 'FFB86C' },
                    { token: 'property', foreground: '9CDCFE' },
                    { token: 'operator', foreground: 'D4D4D4' },
                    { token: 'delimiter', foreground: 'D4D4D4' }
                ],
                colors: {
                    'editor.background': '#0d1117',
                    'editor.foreground': '#e6edf3',
                    'editor.lineHighlightBackground': '#161b22',
                    'editor.selectionBackground': '#264f78',
                    'editor.inactiveSelectionBackground': '#3a3d41',
                    'editorCursor.foreground': '#ffffff',
                    'editorWhitespace.foreground': '#404040',
                    'editorLineNumber.foreground': '#6e7681',
                    'editorLineNumber.activeForeground': '#f0f6fc'
                }
            });

            monaco.languages.register({ id: 'luau' });
            
            monaco.languages.setMonarchTokensProvider('luau', {
                keywords: [
                    'and', 'break', 'do', 'else', 'elseif', 'end', 'false', 'for', 'function',
                    'if', 'in', 'local', 'nil', 'not', 'or', 'repeat', 'return', 'then',
                    'true', 'until', 'while', 'continue', 'export', 'type'
                ],
                
                builtins: [
                    'assert', 'collectgarbage', 'error', 'getfenv', 'getmetatable', 'ipairs',
                    'load', 'loadstring', 'next', 'pairs', 'pcall', 'print', 'rawequal',
                    'rawget', 'rawset', 'select', 'setfenv', 'setmetatable', 'tonumber',
                    'tostring', 'type', 'unpack', 'xpcall', 'require', 'typeof', 'warn'
                ],
                
                robloxGlobals: [
                    'game', 'workspace', 'script', 'shared', 'plugin', '_G', '_VERSION',
                    'Enum', 'Instance', 'Vector2', 'Vector3', 'CFrame', 'UDim', 'UDim2',
                    'Color3', 'BrickColor', 'Ray', 'Faces', 'Axes', 'Region3', 'Region3int16',
                    'NumberSequence', 'NumberSequenceKeypoint', 'ColorSequence', 'ColorSequenceKeypoint',
                    'NumberRange', 'Rect', 'PhysicalProperties', 'Random', 'DateTime', 'TweenInfo'
                ],
                
                apiLibraries: [
                    'cache', 'crypt', 'debug', 'Drawing', 'filesystem', 'input', 'instances',
                    'metatable', 'misc', 'scripts', 'WebSocket', 'console',
                    
                    'Closures', 'Cryptography', 'Environment', 'Metatables', 'Miscellaneous',
                    'Reflection', 'Scripts', 'Signals', 'Websocket'
                ],
                
                apiGlobals: [],
                
                operators: [
                    '=', '>', '<', '!', '~', '?', ':', '==', '<=', '>=', '!=',
                    '&&', '||', '++', '--', '+', '-', '*', '/', '&', '|', '^', '%',
                    '<<', '>>', '>>>', '+=', '-=', '*=', '/=', '&=', '|=', '^=',
                    '%=', '<<=', '>>=', '>>>='
                ],

                symbols: /[=><!~?:&|+\-*\/\^%]+/,
                escapes: /\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,

                tokenizer: {
                    root: [
                        [/[a-zA-Z_]\w*/, {
                            cases: {
                                '@keywords': 'keyword',
                                '@builtins': 'type',
                                '@robloxGlobals': 'constant',
                                '@apiLibraries': 'constant.other.color',
                                '@apiGlobals': 'support.function',
                                '@default': 'identifier'
                            }
                        }],
                        
                        [/[A-Z][\w\$]*/, 'type.identifier'],
                        
                        { include: '@whitespace' },
                        
                        [/[{}()\[\]]/, '@brackets'],
                        [/[<>](?!@symbols)/, '@brackets'],
                        [/@symbols/, {
                            cases: {
                                '@operators': 'operator',
                                '@default': ''
                            }
                        }],
                        
                        [/\d*\.\d+([eE][\-+]?\d+)?/, 'number.float'],
                        [/0[xX][0-9a-fA-F]+/, 'number.hex'],
                        [/\d+/, 'number'],
                        
                        [/[;,.]/, 'delimiter'],
                        
                        [/"([^"\\]|\\.)*$/, 'string.invalid'],
                        [/'([^'\\]|\\.)*$/, 'string.invalid'],
                        [/"/, 'string', '@string."'],
                        [/'/, 'string', '@string.\''],
                        [/\[\[/, 'string', '@string_multiline'],
                    ],

                    string: [
                        [/[^\\"']+/, 'string'],
                        [/@escapes/, 'string.escape'],
                        [/\\./, 'string.escape.invalid'],
                        [/["']/, {
                            cases: {
                                '$#==$S2': { token: 'string', next: '@pop' },
                                '@default': 'string'
                            }
                        }]
                    ],
                    
                    string_multiline: [
                        [/[^\]]+/, 'string'],
                        [/\]\]/, 'string', '@pop'],
                        [/\]/, 'string']
                    ],

                    whitespace: [
                        [/[ \t\r\n]+/, 'white'],
                        [/--\[\[/, 'comment', '@comment_multiline'],
                        [/--.*$/, 'comment'],
                    ],
                    
                    comment_multiline: [
                        [/[^\]]+/, 'comment'],
                        [/\]\]/, 'comment', '@pop'],
                        [/\]/, 'comment']
                    ],
                }
            });

            monaco.languages.setLanguageConfiguration('luau', {
                comments: {
                    lineComment: '--',
                    blockComment: ['--[[', ']]']
                },
                brackets: [
                    ['{', '}'],
                    ['[', ']'],
                    ['(', ')']
                ],
                autoClosingPairs: [
                    { open: '{', close: '}' },
                    { open: '[', close: ']' },
                    { open: '(', close: ')' },
                    { open: '"', close: '"' },
                    { open: "'", close: "'" },
                ],
                surroundingPairs: [
                    { open: '{', close: '}' },
                    { open: '[', close: ']' },
                    { open: '(', close: ')' },
                    { open: '"', close: '"' },
                    { open: "'", close: "'" },
                ],
                folding: {
                    markers: {
                        start: new RegExp("^\\s*--\\s*#region\\b"),
                        end: new RegExp("^\\s*--\\s*#endregion\\b")
                    }
                }
            });

            if (apiParser && apiParser.getGlobalAPIFunctions().length > 0) {
                const apiGlobals = apiParser.getGlobalAPIFunctions();
                console.log('[ INFO ] Adding', apiGlobals.length, 'API globals to language definition');
                
                const currentTokenizer = monaco.languages.getLanguages().find(lang => lang.id === 'luau');
                if (currentTokenizer) {
                }
            }

            monaco.languages.registerCompletionItemProvider('luau', {
                provideCompletionItems: function(model, position) {
                    const word = model.getWordUntilPosition(position);
                    const range = {
                        startLineNumber: position.lineNumber,
                        endLineNumber: position.lineNumber,
                        startColumn: word.startColumn,
                        endColumn: word.endColumn
                    };

                    const suggestions = [
                        {
                            label: 'function',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'function ${1:name}(${2:params})\n\t${3:-- code here}\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Define a new function',
                            range: range
                        },
                        {
                            label: 'local function',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'local function ${1:name}(${2:params})\n\t${3:-- code here}\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Define a local function',
                            range: range
                        },
                        {
                            label: 'if',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'if ${1:condition} then\n\t${2:-- code here}\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'If statement',
                            range: range
                        },
                        {
                            label: 'for',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'for ${1:i} = ${2:1}, ${3:10} do\n\t${4:-- code here}\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Numeric for loop',
                            range: range
                        },
                        {
                            label: 'for in pairs',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'for ${1:key}, ${2:value} in pairs(${3:table}) do\n\t${4:-- code here}\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Iterate over table with pairs',
                            range: range
                        },
                        {
                            label: 'for in ipairs',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'for ${1:index}, ${2:value} in ipairs(${3:array}) do\n\t${4:-- code here}\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Iterate over array with ipairs',
                            range: range
                        },
                        {
                            label: 'while',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'while ${1:condition} do\n\t${2:-- code here}\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'While loop',
                            range: range
                        },
                        {
                            label: 'repeat',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'repeat\n\t${1:-- code here}\nuntil ${2:condition}',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Repeat until loop',
                            range: range
                        },

                        {
                            label: 'game:GetService',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'game:GetService("${1:ServiceName}")',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Get a Roblox service',
                            range: range
                        },
                        {
                            label: 'Players',
                            kind: monaco.languages.CompletionItemKind.Class,
                            insertText: 'game:GetService("Players")',
                            documentation: 'Players service - manages player connections',
                            range: range
                        },
                        {
                            label: 'Workspace',
                            kind: monaco.languages.CompletionItemKind.Class,
                            insertText: 'game:GetService("Workspace")',
                            documentation: 'Workspace service - contains the 3D world',
                            range: range
                        },
                        {
                            label: 'ReplicatedStorage',
                            kind: monaco.languages.CompletionItemKind.Class,
                            insertText: 'game:GetService("ReplicatedStorage")',
                            documentation: 'ReplicatedStorage service - shared between client and server',
                            range: range
                        },
                        {
                            label: 'TweenService',
                            kind: monaco.languages.CompletionItemKind.Class,
                            insertText: 'game:GetService("TweenService")',
                            documentation: 'TweenService - for smooth animations',
                            range: range
                        },
                        {
                            label: 'RunService',
                            kind: monaco.languages.CompletionItemKind.Class,
                            insertText: 'game:GetService("RunService")',
                            documentation: 'RunService - for frame-based events',
                            range: range
                        },
                        {
                            label: 'UserInputService',
                            kind: monaco.languages.CompletionItemKind.Class,
                            insertText: 'game:GetService("UserInputService")',
                            documentation: 'UserInputService - handle user input',
                            range: range
                        },

                        {
                            label: 'Vector3.new',
                            kind: monaco.languages.CompletionItemKind.Constructor,
                            insertText: 'Vector3.new(${1:x}, ${2:y}, ${3:z})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Create a new Vector3',
                            range: range
                        },
                        {
                            label: 'Vector2.new',
                            kind: monaco.languages.CompletionItemKind.Constructor,
                            insertText: 'Vector2.new(${1:x}, ${2:y})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Create a new Vector2',
                            range: range
                        },
                        {
                            label: 'CFrame.new',
                            kind: monaco.languages.CompletionItemKind.Constructor,
                            insertText: 'CFrame.new(${1:position})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Create a new CFrame',
                            range: range
                        },
                        {
                            label: 'Color3.new',
                            kind: monaco.languages.CompletionItemKind.Constructor,
                            insertText: 'Color3.new(${1:r}, ${2:g}, ${3:b})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Create a new Color3 (RGB values 0-1)',
                            range: range
                        },
                        {
                            label: 'Color3.fromRGB',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'Color3.fromRGB(${1:r}, ${2:g}, ${3:b})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Create Color3 from RGB values (0-255)',
                            range: range
                        },
                        {
                            label: 'UDim2.new',
                            kind: monaco.languages.CompletionItemKind.Constructor,
                            insertText: 'UDim2.new(${1:scaleX}, ${2:offsetX}, ${3:scaleY}, ${4:offsetY})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Create a new UDim2 for GUI positioning',
                            range: range
                        },

                        {
                            label: 'Instance.new',
                            kind: monaco.languages.CompletionItemKind.Constructor,
                            insertText: 'Instance.new("${1:ClassName}")',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Create a new Roblox instance',
                            range: range
                        },
                        {
                            label: 'wait',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'wait(${1:seconds})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Wait for specified seconds',
                            range: range
                        },
                        {
                            label: 'spawn',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'spawn(function()\n\t${1:-- code here}\nend)',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Run code in a new thread',
                            range: range
                        },
                        {
                            label: 'coroutine.create',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'coroutine.create(function()\n\t${1:-- code here}\nend)',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Create a new coroutine',
                            range: range
                        },

                        {
                            label: 'type',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'type ${1:TypeName} = {\n\t${2:field}: ${3:type}\n}',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Define a new type',
                            range: range
                        },
                        {
                            label: 'export type',
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: 'export type ${1:TypeName} = ${2:type}',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Export a type from module',
                            range: range
                        },

                        {
                            label: 'print',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'print(${1:value})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Print value to output',
                            range: range
                        },
                        {
                            label: 'warn',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'warn(${1:message})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Print warning message',
                            range: range
                        },
                        {
                            label: 'error',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'error(${1:message})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Throw an error',
                            range: range
                        },
                        {
                            label: 'pcall',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'local success, result = pcall(${1:function}, ${2:args})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Protected call - catch errors',
                            range: range
                        },
                        {
                            label: 'typeof',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'typeof(${1:value})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Get type of value (Luau enhanced)',
                            range: range
                        },

                        {
                            label: 'table.insert',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'table.insert(${1:table}, ${2:value})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Insert value into table',
                            range: range
                        },
                        {
                            label: 'table.remove',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'table.remove(${1:table}, ${2:index})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Remove value from table',
                            range: range
                        },
                        {
                            label: 'table.sort',
                            kind: monaco.languages.CompletionItemKind.Function,
                            insertText: 'table.sort(${1:table})',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Sort table in place',
                            range: range
                        }
                    ];

                    if (apiParser && apiParser.apiCompletions.length > 0) {
                        const wordText = word.word || '';
                        const apiSuggestions = apiParser.getCompletionsForPrefix(wordText);
                        
                        apiSuggestions.forEach(suggestion => {
                            suggestion.range = range;
                        });
                        
                        suggestions.push(...apiSuggestions);
                        
                        console.log('[ INFO ] Added', apiSuggestions.length, 'API completions for prefix:', wordText);
                    }

                    return { suggestions: suggestions };
                }
            });

            const sampleCode = `-- AetherCore Executor Monaco-Editor`;

            editor = monaco.editor.create(document.getElementById('editor'), {
                value: sampleCode,
                language: 'luau',
                theme: 'aethercore-dark',
                automaticLayout: true,
                
                wordWrap: 'on',
                wordWrapColumn: 120,
                wrappingIndent: 'indent',
                
                fontSize: 14,
                fontFamily: 'Consolas, "Courier New", monospace',
                lineHeight: 20,
                letterSpacing: 0.5,
                
                suggestOnTriggerCharacters: true,
                acceptSuggestionOnEnter: 'on',
                tabCompletion: 'on',
                wordBasedSuggestions: true,
                
                minimap: { enabled: true },
                scrollBeyondLastLine: false,
                smoothScrolling: true,
                cursorBlinking: 'smooth',
                cursorSmoothCaretAnimation: true,
                
                formatOnPaste: true,
                formatOnType: true,
                autoIndent: 'full',
                
                matchBrackets: 'always',
                foldingStrategy: 'indentation',
                showFoldingControls: 'always',
                
                lineNumbers: 'on',
                lineNumbersMinChars: 3,
                rulers: [], 
                
                selectOnLineNumbers: true,
                selectionHighlight: true,
                occurrencesHighlight: true,
                find: {
                    seedSearchStringFromSelection: true,
                    autoFindInSelection: 'never'
                }
            });


            editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyK, function() {
                editor.getAction('editor.action.commentLine').run();
            });
            
            editor.addCommand(monaco.KeyMod.Alt | monaco.KeyMod.Shift | monaco.KeyCode.KeyF, function() {
                editor.getAction('editor.action.formatDocument').run();
            });
            
            console.log('[ SUCCESS ] AetherCore Monaco Editor initialized with API documentation support!');
        });

    </script>
</body>
</html>